package com.tarambola {	import com.greensock.TweenLite;		import flash.display.DisplayObject;	import flash.display.MovieClip;	import flash.display.Shape;	import flash.display.Sprite;	import flash.display.Stage;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.geom.Point;	import flash.system.ApplicationDomain;
	public class TScrollV extends MovieClip {        // Constant variables        private static var DECAY:Number = 0.93;        private static var MOUSE_DOWN_DECAY:Number = 0.5;        private static var SPEED_SPRINGNESS:Number = 0.2;        private static var BOUNCING_SPRINGESS:Number = 0.5;		// variables        private var _mouseDown:Boolean = false;        private var _velocity:Number = 0;        private var _mouseDownY:Number = 0;        private var _mouseDownPoint:Point = new Point();        private var _lastMouseDownPoint:Point = new Point();		private var maskC:Shape;        		        // elements        private var canvasHei:Number = 0;		private var canvas:Sprite;		private var scrollEl:DisplayObject;		private var _stage:Stage;		private var bar:MovieClip;				public function TScrollV(canvas:Sprite, scrollElem:DisplayObject, st:Stage, bar:MovieClip=null) {			this._stage=st;			this.maskC = new Draw().dRect(canvas.width, canvas.height-2);			this.bar=bar;			this.canvas = canvas;			this.canvas.buttonMode = true;			this.canvasHei = this.canvas.height;						var MyClass:DisplayObject = scrollElem;			this.scrollEl = scrollElem;//new MyClass();			this.canvas.addChild(this.scrollEl);			this.canvas.addChild(this.maskC);			//this.maskC.x=xMask;			this.maskC.y=1;			this.scrollEl.mask=maskC;			//addChild(this.canvas);						if(scrollElem.height>maskC.height)			{			// add handlers			this.canvas.addEventListener(MouseEvent.MOUSE_DOWN, on_mouse_down);			addEventListener(Event.ENTER_FRAME, on_enter_frame1);			}			this.addChild(this.canvas);		}				private function on_enter_frame1(e:Event):void{            // decay the velocity			if(this.bar!=null)			{			if(_velocity>0.1 || _velocity<-0.1)				this.bar.alpha=1;			else				this.bar.alpha=0;			}			if(this.bar!=null)			{			var perc:Number = (this.scrollEl.y /(this.scrollEl.height - this.maskC.height));			if(perc>0)				perc=0;			if(perc<-1)				perc=-1;			var a:Number = (-perc* (this.maskC.height+this.maskC.y-this.maskC.height-this.maskC.height+100)) ;//-this.maskC.height + this.maskC.y;			TweenLite.to(this.bar, 0.4, { y:-a+38 });			}			            if(_mouseDown) _velocity *= MOUSE_DOWN_DECAY;            else _velocity *= DECAY;            // if not mouse down, then move the element with the velocity            if (!_mouseDown)            {                var textHeight:Number = this.scrollEl.height;                var y:Number = this.scrollEl.y;                var bouncing:Number = 0;                // calculate a bouncing when the text moves over the canvas size                if (y > 0)                {                    bouncing = -y * BOUNCING_SPRINGESS;                }				else if( y + textHeight < this.canvasHei)				{                    bouncing = (this.canvasHei - textHeight - y) * BOUNCING_SPRINGESS;                }                this.scrollEl.y = y + _velocity + bouncing;            }		}				// when mouse button up        private function on_mouse_down(e:MouseEvent):void        {            if (!_mouseDown)            {                // get some initial properties                _mouseDownPoint = new Point(e.stageX, e.stageY);                _lastMouseDownPoint = new Point(e.stageX, e.stageY);                _mouseDown = true;                _mouseDownY = this.scrollEl.y;								// add some more mouse handlers                _stage.addEventListener(MouseEvent.MOUSE_UP, on_mouse_up);                _stage.addEventListener(MouseEvent.MOUSE_MOVE, on_mouse_move);            }        }        // when mouse is moving        private function  on_mouse_move(e:MouseEvent):void        {            if (_mouseDown)            {                // update the element position                var point:Point = new Point(e.stageX, e.stageY);                this.scrollEl.y = _mouseDownY + (point.y - _mouseDownPoint.y);								if( this.scrollEl.y>0 || this.scrollEl.y < -(this.scrollEl.height -this.maskC.height))					on_mouse_up(new MouseEvent(MouseEvent.MOUSE_UP));                // update the velocity                _velocity += ((point.y - _lastMouseDownPoint.y) * SPEED_SPRINGNESS);                _lastMouseDownPoint = point;            }        }        // clear everythign when mouse up        private function  on_mouse_up(e:MouseEvent):void        {            if (_mouseDown)            {                _mouseDown = false;                _stage.removeEventListener(MouseEvent.MOUSE_UP, on_mouse_up);                _stage.removeEventListener(MouseEvent.MOUSE_MOVE, on_mouse_move);            }        }	}}